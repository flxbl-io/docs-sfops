# 3. Setting up sfops repository

Once you have forked the repository from sfops upstream (contact team for access) into a repository in your GitHub organisation, please set up the following variables and secrets.

### Variables & Secrets

To use the associated workflows, you need to set the following repository secrets and variables:

#### GitHub Authentication

##### GitHub Personal Access Token

| Variable  | Type              | Value Type | Example | Comments                                                             |
|-----------|-------------------|------------|---------|----------------------------------------------------------------------|
| GHA_TOKEN | Repository Secret | String     | ghp_... | The GitHub PAT created in [Prerequisites](./README.md#prerequisites) |

##### GitHub App Credentials

These credentials are from the sfops-bot [GitHub App](./github-app.md):

| Variable                 | Type                  | Value Type | Example           | Comments                                                             |
|--------------------------|-----------------------|------------|-------------------|----------------------------------------------------------------------|
| SFOPSBOT_APP_ID          | Organization Variable | String     | 1768214           | The App ID from your GitHub App settings page                        |
| SFOPSBOT_APP_PRIVATE_KEY | Organization Secret   | String     | -----BEGIN RSA... | The entire contents of the .pem file downloaded from your GitHub App |

#### Docker Registry Configuration

##### Secrets for Pushing Your Built Images to GitHub Container Registry

These secrets are required to push the built sfops Docker images to GitHub Container Registry (ghcr.io):

| Variable          | Type              | Value Type | Example | Comments                                                        |
|-------------------|-------------------|------------|---------|-----------------------------------------------------------------|
| DOCKER_PUSH_TOKEN | Repository Secret | String     | ghp_... | GitHub PAT with write:packages permission (can reuse GHA_TOKEN) |

{% hint style="info" %}
**Note:** The sfops workflows currently only support pushing to GitHub Container Registry (ghcr.io). The workflow automatically uses your GitHub username for authentication.
{% endhint %}

##### Configuration for Pulling Base Images

These settings configure where to pull the sfp-pro base images that sfops Docker images are built upon:

**Default Setup (Using official sfp-pro from Gitea):**

| Variable               | Type                | Value Type | Example         | Comments                                            |
|------------------------|---------------------|------------|-----------------|-----------------------------------------------------|
| BASE_REGISTRY          | Repository Variable | String     | source.flxbl.io | Keep as source.flxbl.io for official images         |
| BASE_REPO              | Repository Variable | String     | flxbl           | Keep as flxbl for official images                   |
| BASE_REGISTRY_USERNAME | Repository Secret   | String     | your-username   | Your Gitea username                                 |
| BASE_REGISTRY_TOKEN    | Repository Secret   | String     | gitea_token     | Your Gitea token (same as created in Prerequisites) |

{% hint style="info" %}
**If you've forked sfp-pro** ([instructions](https://docs.flxbl.io/sfp/getting-started/docker-images/sfp-pro#building-docker-images)):

**Example for GitHub Container Registry:**

| Variable               | Type                | Value Type | Example       | Comments                           |
|------------------------|---------------------|------------|---------------|------------------------------------|
| BASE_REGISTRY          | Repository Variable | String     | ghcr.io       | GitHub Container Registry          |
| BASE_REPO              | Repository Variable | String     | your-org      | Your GitHub organization name      |
| BASE_REGISTRY_USERNAME | Repository Secret   | String     | your-username | Your GitHub username               |
| BASE_REGISTRY_TOKEN    | Repository Secret   | String     | ghp_...       | Your GitHub PAT with read:packages |

For other registries (JFrog, Docker Hub, etc.), update the BASE_REGISTRY and BASE_REPO variables to point to your registry, and provide appropriate credentials for BASE_REGISTRY_USERNAME and BASE_REGISTRY_TOKEN.
{% endhint %}

#### Environment Configuration

##### Test Environment Variables

To test the workflow before provisioning to your actual GitHub action repository, you need to set up the following

| Variable            | Type                 | Value Type   | Example                                    | Comments                                                                                                                                  |
|---------------------|----------------------|--------------|--------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| TEST\_ORGS          | Repository Variable  | String Array | \['flxbl']                                 | Should be the name of the environment                                                                                                     |
| REPO\_OWNER         | Environment Variable | String       | \<your\_org\_name>                         | Name of the github organisation                                                                                                           |
| PROJECT\_REPO       | Environment Variable | String       | sf-test-repo                               | These variables should be created within the environment variable named in TEST\_ORGS The Project where this action would be invoked from |
| SFOPS\_ACTION\_REPO | Environment Variable | String       | sfops-gh-actions-test                      | The repository that contains the actions                                                                                                  |
| SFOPS\_IMAGE        | Environment Variable | String       | ghcr.io/flxbl-io/\<your\_org>:development  | The image to be used along with the tag                                                                                                   |
| SFOPS\_LITE\_IMAGE  | Environment Variable | String       | ghcr.io/\<your-org>/sfops-lite:development | The lite image to be used along with the tag                                                                                              |

{% hint style="info" %}
After configuring these test environment variables, you can test the **"Build & Deploy to Dev Orgs"** workflow from the Actions tab.
{% endhint %}

##### Production Environment Variables

To deploy the workflow to the actual org, please setup the following

| Variable            | Type                 | Value Type   | Example                                | Comments                                                                                                                                  |
|---------------------|----------------------|--------------|----------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| ORGS                | Repository Variable  | String Array | \['super-org']                         | Should be the name of the environment                                                                                                     |
| REPO\_OWNER         | Environment Variable | String       | \<your\_org\_name>                     | Name of the github organisation                                                                                                           |
| PROJECT\_REPO       | Environment Variable | String       | sf-core                                | These variables should be created within the environment variable named in TEST\_ORGS The Project where this action would be invoked from |
| SFOPS\_ACTION\_REPO | Environment Variable | String       | sfops-gh-actions                       | The repository that contains the actions                                                                                                  |
| SFOPS\_IMAGE        | Environment Variable | String       | ghcr.io/\<your\_org>/sfops:latest      | The image to be used along with the tag                                                                                                   |
| SFOPS\_LITE\_IMAGE  | Environment Variable | String       | ghcr.io/\<your\_org>/sfops-lite:latest | The lite image to be used along with the tag                                                                                              |

{% hint style="info" %}
After configuring these production environment variables, you can run the **"Sync Organization"** workflow to deploy sfops to your production repositories. See [4. Trigger the workflows](./4.-trigger-the-workflows.md) for detailed steps.
{% endhint %}

{% hint style="warning" %}
These variables will be automatically set up during the set up of sfops in your repository by the FLXBL team. This guide is only applicable when you are setting up a self managed instance of sfops
{% endhint %}
